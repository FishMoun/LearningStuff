# 阅读笔记

## 第一章 导入器基础

这一章节主要介绍了入门Simulink Importer的基础方面和原则，并且描述了其面向用户的整体工作流

**先决条件与说明**

* simulink importer

从simulink或matlab环境中生成一个部分由导入节点组成的scade模型

* 先决条件

simulink，stateflow，matlab的有效说明的安装

模型的仿真在simulink中必须可行

* 说明

支持mdl和slx格式

生成的scade模型适用于scade6.6及以上

生成模型是必定成功的：未知的模块会被转换成空的scade算子

对simulink、stateflow结构的同时转换

**导入器总体原则**

被转换的simulink模型必须包含一个离散子系统，这个子系统被称为控制器，这个控制器就是会被转换的一部分。转换的目标是获得一个与原simulink子系统输入输出表现一致的scade算子。重现算子的行为可能需要对生成的scade模型的一些人工调校

* hierarchical translation

为了保证可追踪性，原simulink模块的图与路径结构必须尽可能的保存下来

1、simulink系统会被转换成对应的具有同样输入输出的scade算子，simulink模块会被转换成对一个预定义的算子调用，或者对scadelibrary中算子的调用，或者对一个动态生成的算子的调用

2、simulink的信号会被转换成scade中的本地变量，为了转换的可追踪性，图源的展示会在一定程度上保留，

3、除了虚拟子系统外，子系统的路径会被平扁化。从控制器和scade的根目录开始，非虚拟子系统会被转换成当前包下的scade算子。相反的，对于虚拟子系统，一个scade包会被引入来收集所有的算子，每个算子对应一个虚拟子系统，所有的常量对应每一个被使用到的masked变量

**stateflow结构转换成状态机**

stateflow和scade状态机的形式都描述了层次化、并行的状态机。对并发性、广播通信和优先权等stateflow结构的理解可能会变得非常复杂。在实践中，设计师必须设置严格限制或禁止使用



强大结构的规则。在建模安全关键系统时，限制使用复杂结构来减少控制的缺乏是不可取的。Simulink Importer可以将stateflow规范重新捕获到StateMachine同步形式的语义中，从而增强对嵌入式软件的信心。Simulink Importer从Stateflow图文件中导入设计构造，并基于状态流图创建包含State Machine的Scade操作符。即使Stateflow的图形和语法迁移到StateMachine更容易，也没有使用直接可重用的算子进行完全转换。对于类型和语义问题，一些结构是无法被转换的，或者需要scade模型在设计上的改变



**模块化导入**

Simulink Importer会将一个Simulink模型的每一个子部分转换成SCADE的包。当转换一个更高层级的simulink模型时，会重用之前生成的scade包作为转换的子系统的一部分。

![image-20240202104012325](https://raw.githubusercontent.com/FishMoun/ImageStorage/main/picGo/image-20240202104012325.png)

模块化可以被用作对大型simulink模型的分解，这将Simulink模型的小修改对转换的SCADE模型的影响降到最低，并保存了验证活动

**Simulink Importer的工作流**

用户对于simulink模型转换包括了一系列由scade和simulink环境完成的任务

![image-20240202104413277](https://raw.githubusercontent.com/FishMoun/ImageStorage/main/picGo/image-20240202104413277.png)



1、将simulink模型在matlab环境中导出为json文件

2、在scade环境中导入并启动对simulink模型的转换工作

3、通过修改配置文件来修改转换结果

4、对更新后的simulink模型进行重导入

基于配置文件，simulink importer支持模块化的从低层次到高层次的模块化导入

从simulink转换的scade模型也支持对仿真的验证活动以及对控制器的嵌入式代码生成

## 第二章 运行Simulink Importer

这一章节解释了如何使用simulink importer，作为对实时嵌入式系统的控制和软件开发的桥梁。这个工具支持将simulink模型转换为scade模型，stateflow会转换为state machine

**转换simulink模型和stateflow**

simulink importer将在scade环境中启动

* 将simulink模型导出为JSON文件

1、在matlab中打开需要转换的simulink模型，模型必须已经可以处于仿真的状态

2、在scade安装的目录下找到sl_export的脚本程序

3、从matlab命令行提示中，使用命令

sl_export(<sysytem>,[options])

这个命令的逻辑如下所示：

```
<system>:表示系统的名字或者路径
[options]:
OutputFile: 表示输出json的文件名，默认是test.json
Progress: 表示展示进度条，默认是false
Verbose:表示开启复杂模式展示导出系统的信息，默认是false
Cfg: 表示标出用户自定义文件，默认是空 {}
MainCfg:表示使用主配置文件。默认是true
InlineLibs：表示内联库内容和模型引用模块，默认是true，如果是false，内联库内容和模型引用模块必须通过模块化分别导入，否则它们会被转换成scade的导入算子
```

![image-20240202111717070](https://raw.githubusercontent.com/FishMoun/ImageStorage/main/picGo/image-20240202111717070.png)

**运行模型转换**

1、在scade中，打开一个scade模型用于导入simulink模型

2、打开simulink importer

![image-20240202111909178](https://raw.githubusercontent.com/FishMoun/ImageStorage/main/picGo/image-20240202111909178.png)

3、在输入模型中，标出json文件的未知，其中包括了需要导入的模型，

4、标记出是否需要转换控制器或者总线，枚举，模型参数，模型变量等

* 设置控制器来标出需要转换的控制器的路径，默认的是根目录
* 设置共享声明来只转换总线、枚举、模型参数、模型变量到一个特定的包内

5、在scade包中，标出生成模型的存放位置，默认是$(Controller)，扩展为所选控制器的名称，并修改以在SCADE中获得有效的标识符，或者在转换总线、枚举、模型参数和模型变量时

6、标出另外的配置文件，来自定义simulink模块的转换

7、点击下一步进行高级选项设置

![image-20240202112621952](https://raw.githubusercontent.com/FishMoun/ImageStorage/main/picGo/image-20240202112621952.png)

8、设置如下的高级选项：

* disable saturation：用cast来替换saturation代码
* no trace pagmas：不生成可追踪的程序，同样会取消定位在simulink模型中的行为
* ingnore signal names：避免生成新的信号名称在创建格外的本地变量时。相反的，信号会以L作为基本名称，并且会在scade模型中转换为内部变量
* tanslate matlab variable as sensors：将全局的matlab变量转换为scade中的传感器而不是常量
* translate simulink parameters as sensors：将simulink参数转换为scade中的传感器而不是常量
* Embed states content：在嵌入的模式中生成状态图
* mask parameters translation：将mask的参数变为以下的量：
  * const：常量实现了对应mask构件的参数以及算子
  * inline：在parameter出现的地方，直接使用参数的被计算值
  * input：为了转换每一个mask参数作为一个算子的新的输入，算子调用为这些特定的输入提供在整个子系统实例化期间计算出的掩码值
* consider warnings as error：将警告代码作为错误
* ignore warnings：忽略警告信息

**模型转换的重导入**

在转换结束simulink模型之后，可以再次重新导入scade项目，模型的重导入可以更新scade模型每当simulink/stateflow模型发生变量或者需要在配置文件中修改转换规则





## 第三章 Simulink/Stateflow 的转换



## 附录A 配置文件的语法和语义



## 附录B Simulink库的构件映射



## 附录C 所支持的MATLAB和Stateflow语言



## 附录D 错误和警告信息

